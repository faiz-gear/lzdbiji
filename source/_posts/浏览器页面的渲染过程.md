---
title:  浏览器页面的渲染过程
tag: 浏览器渲染
keywords: 浏览器渲染
categories: 浏览器相关知识
---
# 浏览器页面的渲染过程

### 1.输入网址

当用户在地址栏输入一个搜索关键字时，地址栏会判断当前输入的关键字是搜索内容，还是请求的URL

- 如果是搜索内容，地址栏会使用浏览器设置的默认的搜索引擎，生成对应的带搜索关键字的URL地址
- 如果输入的内容符合URL规则，那么地址栏根据规则，把这段内容加上协议，合成为完整的URL

当用户输入关键字并键入回车之后，这意味着当前页面即将要替换成新的页面，不过在这个流程继续之前，浏览器会给当前页面一次执行beforeunload事件，以执行一些数据清理操作

### 2.解析URL

URL主要由协议、主机、端口、路径、查询参数和锚点6部分构成。输入URL之后，浏览器会将这些信息构成一个HTTP请求

### 3.检查浏览器缓存

接下来，网络进程会查找本地缓存是否缓存该URL地址的资源。如果有缓存资源，那么会直接将缓存的资源返回给浏览器进程；如果没有在缓存没有找到缓存资源，那么直接进入到网络请求流程

优化：1.开启浏览器缓存；2.第三方库公共模块抽取

### 4.DNS解析

在发起http请求之前，浏览器首先要去获得我们想访问网页的IP地址，浏览器会发送一个UDP的包给DNS域名解析服务器，DNS服务器会返回给浏览器对应的IP地址

优化：1.DNS预解析（大型网站，有多个不同服务器资源的情况下，都可采取DNS预解析，提前解析，减少页面卡顿）

### 5.TCP/IP报文

三次握手

### 6.http请求

连接建立之后，浏览器端会构建请求行、请求头和请求体等信息，并把和该域名想换的Cookie等数据附加到请求头中，然后向服务器发送构建的请求信息

### 7.服务器解析请求并返回http报文

服务器接收到请求信息后，会根据请求信息生成相应数据（包括响应行、响应头和响应体等信息），并发给网络进程。等网络进程接收了响应行和响应头之后，就开始解析响应的内容了

### 8.浏览器渲染页面

- DOM树（DOM）
  - 字节（Bytes） -> 字符（Characters） > 令牌（token） -> 节点（Nodes）-> 文档对象模型（DOM）
- CSS对象模型（CSSOM）
- 布局树Layout Tree
  - DOM树与CSSOM树合并后形成渲染树（RenderTree）
  - 渲染树只包含渲染网页所需的节点
  - 布局计算每个对象的精确位置和大小
  - 最后一步是绘制，使用最终渲染树将像素渲染到屏幕上
- 渲染
  1. 获取DOM后分割为多个图层
  2. 对每个图层的节点计算样式结果（Recalculate style --样式重计算）
  3. 为每个节点生成图形和位置（Layout --重排，回流）
  4. 将每个节点绘制填充到图层位图中（Paint --重绘）
  5. 图层作为纹理上传至GPU
  6. 组合多个图层到页面上生成最终屏幕图像（Composite Layers-- 图层重组）
- 回流和重绘
  - 重绘
    - 当页面中元素样式的改变并不影响它在文档流中的位置时（例如color、backgroundColor、visibility等），浏览器会将新样式赋予给元素并重置绘制它，这个过程称为重绘
  - 回流
    - 当Render Tree中部分或全部元素的尺寸、结构或某些属性发生改变时，浏览器重新渲染部分或者全部文档的过程称为回流
  - 回流必将引起重绘，而重绘不一定会引起回流
- 优化：
  1. 静态资源使用CDN，缩短静态资源请求时间
  2. 将css放在文件头部，JavaScript文件放在底部
  3. 图片优化
     1. 图片压缩
     2. 图片懒加载
     3. 使用svg响应式图片
     4. 使用webp格式的图片
  4. 压缩文件
     1. JavaScript：UglifyPlugin
     2. CSS ：MiniCssExtractPlugin
     3. HTML：HtmlWebpackPlugin
  5. 减少重绘重排
  6. 代码分割（如路由懒加载）
  7. Tree Shaking
     - Tree Shaking的作用就是，通过程序流分析找出代码中无用的代码并剔除
  8. 使用服务端渲染

### 9.断开连接

四次分手